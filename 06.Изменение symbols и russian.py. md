–¢—ã –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–º–µ—Ç–∏–ª, —Ç–∞–º —Å–µ–π—á–∞—Å –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∑–æ–æ–ø–∞—Ä–∫ –∏–∑ IPA –∏ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã üôÉ
–î–∞–≤–∞–π —Ä–∞–∑—Ä—É–ª–∏–º –∏ **—Å–¥–µ–ª–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π, —Ä–∞–±–æ—á–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–¥ —Ç–≤–æ–π –¥–∞—Ç–∞—Å–µ—Ç**.

---

## –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –ª–æ–º–∞–µ—Ç—Å—è —Å–µ–π—á–∞—Å

1. **`RUPhon` error**:

```text
'RUPhon' object has no attribute 'phonemize_list'
```

–ú—ã –≤ `russian.py` –∑–≤–∞–ª–∏ –º–µ—Ç–æ–¥ `phonemize_list`, –∞ –≤ —Ç–≤–æ–µ–π –≤–µ—Ä—Å–∏–∏ RUPhon –µ–≥–æ –ø—Ä–æ—Å—Ç–æ –Ω–µ—Ç (–¥—Ä—É–≥–∞—è –≤–µ—Ä—Å–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏). –¢–æ –µ—Å—Ç—å –ø—É—Ç—å —Å RUPhon —Å–µ–π—á–∞—Å –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

2. **–û—à–∏–±–∫–∏ `symbol '–µ' not in symbols` –∏ —Ç.–ø.**

–¢–≤–æ–π —Ç–µ–∫—É—â–∏–π `g2p` (—á–µ—Ä–µ–∑ fallback `_g2p_char_level`) –æ—Ç–¥–∞—ë—Ç **–æ–±—ã—á–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã** (`–µ`, `–Ω`, `—è`‚Ä¶),
–∞ `symbols2.py` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤ —Ä—É—Å—Å–∫–æ–º –±–ª–æ–∫–µ **IPA-—Ñ–æ–Ω–µ–º—ã** (`"k"`, `"sÀê"`, `" í"`, `"t~…ï"`, `"'…µ"`‚Ä¶), –∫–æ—Ç–æ—Ä—ã–µ RUPhon –∫–æ–≥–¥–∞-—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã–ª –≤—ã–¥–∞–≤–∞—Ç—å.

–ò—Ç–æ–≥–æ:
—Ñ–æ–Ω–µ–º—ã ‚Üí –±—É–∫–≤—ã,
—Å–ª–æ–≤–∞—Ä—å ‚Üí IPA,
–æ–Ω–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Üí –≤—Å—ë —É—Ö–æ–¥–∏—Ç –≤ `UNK`.

–¢—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ª–æ–≥–∏—á–Ω–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—à—å:

> –ó–∞—á–µ–º –º—ã –¥–æ–±–∞–≤–ª—è–µ–º –≤ symbols —Ç–∞–∫–∏–µ —Ñ–æ–Ω–µ–º—ã, –∫–æ–≥–¥–∞ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–±—ã—á–Ω—ã–µ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–µ –±—É–∫–≤—ã?

–û—Ç–≤–µ—Ç: **–≤ —Ç–≤–æ–µ–π —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ‚Äî –≤–æ–æ–±—â–µ –Ω–µ–∑–∞—á–µ–º.**
IPA –∏–º–µ–ª–æ —Å–º—ã—Å–ª —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–∞–±–æ—á–µ–º RUPhon, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–∞—ë—Ç —Ç–∞–∫–∏–µ —Ñ–æ–Ω–µ–º—ã.
–°–µ–π—á–∞—Å –º—ã –µ–≥–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º ‚Üí –ª—É—á—à–µ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π **–±—É–∫–≤–µ–Ω–Ω—ã–π g2p** –∏ –∫–∏—Ä–∏–ª–ª–∏—Ü—É –≤ `symbols`.

---

## –ü–ª–∞–Ω: —Å–¥–µ–ª–∞—Ç—å –≤—Å—ë –ø—Ä–æ—Å—Ç–æ –∏ —Ä–∞–±–æ—á–µ

–î–ª—è –æ–±—É—á–µ–Ω–∏—è TTS (–æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ) —Ç–µ–±–µ **—Ö–≤–∞—Ç–∏—Ç –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ–≥–æ g2p –ø–æ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ**:

* `text_normalize` ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ç–µ–∫—Å—Ç.
* `g2p` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–∏—Å–æ–∫ **–±—É–∫–≤**.
* –í `symbols` / `symbols2` –¥–æ–±–∞–≤–ª—è–µ–º **—ç—Ç–∏ –∂–µ –±—É–∫–≤—ã**.

–ê –≤—Å—ë ¬´—É–º–Ω–æ–µ¬ª (RUPhon, BERT, prosody) –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å, –∫–æ–≥–¥–∞ –æ–±—É—á–µ–Ω–∏–µ —É–∂–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.

### üîß –®–∞–≥ 1. –°—Ç–∞–≤–∏–º –ø—Ä–æ—Å—Ç–æ–π `russian.py`

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `GPT_SoVITS/text/russian.py` –Ω–∞ –≤–æ—Ç —ç—Ç–æ:

```python
# GPT_SoVITS/text/russian.py
"""
–ü—Ä–æ—Å—Ç–æ–π —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è GPT-SoVITS.

- text_normalize(text) -> str
- g2p(text)           -> List[str] (—Å–ø–∏—Å–æ–∫ –±—É–∫–≤-¬´—Ñ–æ–Ω–µ–º¬ª)

–ù–∏–∫–∞–∫–æ–≥–æ RUPhon, –Ω–∏–∫–∞–∫–æ–≥–æ BERT ‚Äî –º–∞–∫—Å–∏–º—É–º –ø—Ä–æ—Å—Ç–æ—Ç—ã, —á—Ç–æ–±—ã
–ø–∞–π–ø–ª–∞–π–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–ª.

–ö–æ–≥–¥–∞ –∑–∞—Ö–æ—á–µ—à—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–º—É –≤–∞—Ä–∏–∞–Ω—Ç—É —Å RUPhon/BERT
–¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –∏–Ω—Ç–æ–Ω–∞—Ü–∏–∏, —ç—Ç–æ –ª—É—á—à–µ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª
(–Ω–∞–ø—Ä–∏–º–µ—Ä, russian_prosody.py), —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å –±–∞–∑–æ–≤—ã–π TTS-–ø–æ—Ç–æ–∫.
"""

import re
from typing import List


def text_normalize(text: str) -> str:
    """
    –ë–∞–∑–æ–≤–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:
    - –ø—Ä–∏–≤–æ–¥–∏–º –∫ —Å—Ç—Ä–æ–∫–µ
    - –æ–±—Ä–µ–∑–∞–µ–º –ø—Ä–æ–±–µ–ª—ã
    - –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    - –∑–∞–º–µ–Ω—è–µ–º –Å -> –ï
    - –æ—Å—Ç–∞–≤–ª—è–µ–º —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –±–∞–∑–æ–≤—É—é –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é
    """
    if not isinstance(text, str):
        text = str(text)

    text = text.strip()
    if not text:
        return ""

    text = text.replace("–Å", "–ï")
    text = text.replace("—ë", "–µ")
    text = text.lower()

    # –æ—Å—Ç–∞–≤–ª—è–µ–º: –∞-—è, 0-9, –ø—Ä–æ–±–µ–ª, –∑–∞–ø—è—Ç–∞—è, —Ç–æ—á–∫–∞, ? !, –¥–µ—Ñ–∏—Å
    text = re.sub(r"[^–∞-—è0-9 ,.!?\-]", " ", text)
    text = re.sub(r"\s+", " ", text).strip()
    return text


def g2p(text: str) -> List[str]:
    """
    –ü–æ—Å–∏–º–≤–æ–ª—å–Ω—ã–π g2p:
    - –Ω–∞ –≤—ã—Ö–æ–¥–µ —Å–ø–∏—Å–æ–∫ —Å–∏–º–≤–æ–ª–æ–≤ (–±—É–∫–≤—ã, –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è),
    - –ø—Ä–æ–±–µ–ª—ã –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º (–ø–∞—É–∑—ã —à—å—é—Ç—Å—è —Å–∞–º–∏–º TTS –ø–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏).
    """
    norm = text_normalize(text)
    phones: List[str] = []

    for ch in norm:
        if ch == " ":
            continue
        phones.append(ch)

    return phones


if __name__ == "__main__":
    s = "–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä! 123"
    print("Norm:", text_normalize(s))
    print("Phones:", g2p(s))
```

–¢–µ–ø–µ—Ä—å –Ω–∏–∫–∞–∫–æ–≥–æ RUPhon ‚Üí –æ—à–∏–±–∫–∏ `'phonemize_list'` –∏—Å—á–µ–∑–Ω—É—Ç.

---

### üîß –®–∞–≥ 2. –ü–æ—á–∏–Ω–∏—Ç—å `symbols.py` / `symbols2.py` –ø–æ–¥ –∫–∏—Ä–∏–ª–ª–∏—Ü—É

–°–µ–π—á–∞—Å —É —Ç–µ–±—è –≤ `symbols.py` / `symbols2.py` –≤–Ω–∏–∑—É —á—Ç–æ-—Ç–æ —Ç–∏–ø–∞:

```python
_russian_phonemes = [
    "k",
    "l",
    "sÀê",
    " í",
    "t~…ï",
    "j",
    "'…ê",
    ...
]
symbols = [pad] + c + v + ja_symbols + pu_symbols + list(arpa) + _russian_phonemes
symbols = sorted(set(symbols))
```

–ù–∞–º —ç—Ç–æ **IPA-–¥–æ–±—Ä–æ –Ω–µ –Ω—É–∂–Ω–æ**.
–ó–∞–º–µ–Ω—è–µ–º —ç—Ç–æ—Ç –±–ª–æ–∫ –Ω–∞ **–∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–µ –±—É–∫–≤—ã**.

–ò –≤ `symbols.py`, –∏ –≤ `symbols2.py`:

1. –£–¥–∞–ª—è–µ–º –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ `_russian_phonemes = [...]`.
2. –í–º–µ—Å—Ç–æ –Ω–µ–≥–æ –¥–æ–±–∞–≤–ª—è–µ–º:

```python
# –†—É—Å—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç –¥–ª—è –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ–≥–æ g2p
_russian_letters = list("–∞–±–≤–≥–¥–µ—ë–∂–∑–∏–π–∫–ª–º–Ω–æ–ø—Ä—Å—Ç—É—Ñ—Ö—Ü—á—à—â—ä—ã—å—ç—é—è")

symbols = [pad] + c + v + ja_symbols + pu_symbols + list(arpa) + _russian_letters
symbols = sorted(set(symbols))
```

> ‚ö†Ô∏è –ú—ã –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Å ‚Üí –ï, –Ω–æ —è –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Å—Ç–∞–≤–∏–ª `—ë` –≤ –∞–ª—Ñ–∞–≤–∏—Ç–µ ‚Äî –Ω–µ –º–µ—à–∞–µ—Ç, –∞ –≤–¥—Ä—É–≥ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è.

–ï—Å–ª–∏ –≥–¥–µ-—Ç–æ —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å —Å–±–æ—Ä–∫–∞ `symbols = [...] + _russian_phonemes`, –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ–Ω—è–π `_russian_phonemes` –Ω–∞ `_russian_letters` –∏ —Å–ø–∏—Å–æ–∫ –≤–Ω—É—Ç—Ä–∏.

---

### üîß –®–∞–≥ 3. `cleaner.py` –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å (–∏–∑ –ø—Ä–æ—à–ª–æ–π –≤–µ—Ä—Å–∏–∏)

–¢–æ—Ç `cleaner.py`, –∫–æ—Ç–æ—Ä—ã–π —è –ø—Ä–∏—Å—ã–ª–∞–ª:

* –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ `russian.g2p` –≤–µ—Ä–Ω—ë—Ç –∏–º–µ–Ω–Ω–æ **—Å–ø–∏—Å–æ–∫ —Ñ–æ–Ω–µ–º** (—Ç–µ–ø–µ—Ä—å —ç—Ç–æ –±—É–∫–≤—ã);
* –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Ö –Ω–∞ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –≤ `symbols`;
* –∑–∞–º–µ–Ω—è–µ—Ç –Ω–µ–∑–Ω–∞–∫–æ–º—ã–µ –Ω–∞ `UNK`.

–ü–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫:

* `g2p` ‚Üí –±—É–∫–≤—ã,
* `symbols` ‚Üí —Å–æ–¥–µ—Ä–∂–∏—Ç –±—É–∫–≤—ã,

—Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞:

```text
[cleaner] ERROR: symbol '–Ω' not in symbols, replaced with 'UNK'
```

–¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å.

---

## –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è –≤ –∏—Ç–æ–≥–µ

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –ø—Ä–∞–≤–æ–∫ –∑–∞–ø—É—Å–∫–∞–µ—à—å —Å–Ω–æ–≤–∞:

```bat
"E:\Resound Project\GPT-SoVITS\venv_3.10\Scripts\python.exe" -s GPT_SoVITS/prepare_datasets/1-get-text.py
```

–û–∂–∏–¥–∞–µ–º:

* **–Ω–µ—Ç** —Å–æ–æ–±—â–µ–Ω–∏–π `[russian.py] RUPhon error ...`;
* **–Ω–µ—Ç** `[cleaner] ERROR: symbol '–µ' not in symbols` –∏ —Ç.–ø.;
* –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–º–Ω–æ–≥–æ –≤–æ—Ä–Ω–∏–Ω–≥–æ–≤ –ø–æ –¥—Ä—É–≥–∏–º —è–∑—ã–∫–∞–º, –µ—Å–ª–∏ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –≤–Ω–µ–∑–∞–ø–Ω–æ –æ–∫–∞–∑–∞–ª–∏—Å—å –Ω–µ-ru, –Ω–æ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ –≤—Å—ë –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å—Ç–æ.

---

## –ê —á—Ç–æ —Å ¬´—É–º–Ω—ã–º¬ª RUPhon + BERT?

–¢–æ, —á—Ç–æ –º—ã —Å–µ–π—á–∞—Å —Å–¥–µ–ª–∞–ª–∏, ‚Äî **—Ä–∞–±–æ—á–∏–π –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç—É—Ä –¥–ª—è TTS**:

* –¥–∞—Ç–∞—Å–µ—Ç –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è,
* –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç —É—á–∏—Ç—å—Å—è –∏ –≥–æ–≤–æ—Ä–∏—Ç—å –ø–æ-—Ä—É—Å—Å–∫–∏,
* —Ñ–æ–Ω–µ–º—ã = –±—É–∫–≤—ã ‚Üí –ø—Ä–æ—â–µ –¥–µ–±–∞–∂–∏—Ç—å.

–ö–æ–≥–¥–∞ —Ç—ã:

1. –ü–æ–ª—É—á–∏—à—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –æ–±—É—á–∞—é—â—É—é—Å—è —Ä—É—Å—Å–∫—É—é TTS-–º–æ–¥–µ–ª—å,
2. –ü–æ–¥–±–µ—Ä—ë—à—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é RUPhon,
3. –†–µ—à–∏—à—å –¥–µ–ª–∞—Ç—å –ø—Ä–∞–≤–¥–∞ —Å–ª–æ–∂–Ω—ã–π cross-lingual VC —Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º –∏–Ω—Ç–æ–Ω–∞—Ü–∏–∏,

–º—ã –º–æ–∂–µ–º:

* —Å–¥–µ–ª–∞—Ç—å –≤—Ç–æ—Ä–æ–π –º–æ–¥—É–ª—å, —Å–∫–∞–∂–µ–º `russian_prosody.py`,
  –≥–¥–µ —É–∂–µ –∂–∏–≤—É—Ç RUAccent, RUPhon, BERT, IPA-—Ñ–æ–Ω–µ–º—ã –∏ —Ç.–¥.;
* –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å–æ–µ–¥–∏–Ω–∏—Ç—å –µ–≥–æ —Å SoVITS-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å–æ–º –∏–º–µ–Ω–Ω–æ –¥–ª—è **–ø–µ—Ä–µ–Ω–æ—Å–∞ –ø—Ä–æ—Å–æ–¥–∏–∏**,
  –Ω–µ —Ç—Ä–æ–≥–∞—è –±–∞–∑–æ–≤—ã–π training frontend.

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ —Ç–∞–∫–æ–π:
—Ç—ã –ø—Ä–æ–±—É–µ—à—å —Å —ç—Ç–∏–º–∏ –ø—Ä–∞–≤–∫–∞–º–∏ —Å–Ω–æ–≤–∞ –ø—Ä–æ–≥–Ω–∞—Ç—å `1-get-text.py`, –∫–∏–¥–∞–µ—à—å –∫—É—Å–æ–∫ –ª–æ–≥–∞, –∏ –º—ã —É–∂–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –æ–Ω–æ –ø—Ä–æ—à–ª–æ—Å—å –∏ –Ω–µ—Ç –ª–∏ –µ—â—ë –∫–∞–∫–∏—Ö-—Ç–æ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö ¬´–ø–æ–¥–≤–æ–¥–Ω—ã—Ö –∫–∞–º–Ω–µ–π¬ª.
