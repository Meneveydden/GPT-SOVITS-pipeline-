–ö–æ—Ä–æ—Ç–∫–æ:

* `symbols.py` –∏ `symbols2.py` –≤ —Ç–æ–º –≤–∏–¥–µ, —á—Ç–æ —Ç—ã –ø—Ä–∏—Å–ª–∞–ª ‚Äî **–Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ**, —Ä—É—Å—Å–∫–∏–µ —Ñ–æ–Ω–µ–º—ã —Ç—É–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
* –ê –≤–æ—Ç **`cleaner.py` —Å–µ–π—á–∞—Å —Ç–æ—á–Ω–æ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å** ‚Äî –µ–≥–æ –Ω–∞–¥–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `russian.g2p`.

–†–∞–∑–±–µ—Ä—ë–º—Å—è –ø–æ –ø—É–Ω–∫—Ç–∞–º.

---

## 1. –ß—Ç–æ —Å `symbols` / `symbols2`

–í –æ–±–æ–∏—Ö —Ñ–∞–π–ª–∞—Ö:

* –µ—Å—Ç—å –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä –¥–ª—è –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ, —è–ø–æ–Ω—Å–∫–æ–≥–æ, –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∏ —Ç.–¥.;
* –¥–æ–±–∞–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ `_russian_phonemes = [...]` —Å IPA-–ø–æ–¥–æ–±–Ω—ã–º–∏ —Ä—É—Å—Å–∫–∏–º–∏ —Ñ–æ–Ω–µ–º–∞–º–∏;
* —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ `symbols` —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∫–∞–∫:

  ```python
  symbols = [pad] + c + v + ja_symbols + pu_symbols + list(arpa) + _russian_phonemes
  symbols = sorted(set(symbols))
  ...
  ```

–¢–æ –µ—Å—Ç—å **–ª—é–±–æ–π —Ñ–æ–Ω–µ–º**, –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω—ë—Ç —Ç–≤–æ–π `russian.g2p`, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ `_russian_phonemes`, –ø—Ä–æ–π–¥—ë—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –≤ cleaner –∏ –Ω–µ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—Å—è –≤ `UNK`.

üëâ –í—ã–≤–æ–¥: **—Å–æ —Å—Ç–æ—Ä–æ–Ω—ã —Å–ª–æ–≤–∞—Ä—è —Å–∏–º–≤–æ–ª–æ–≤ –≤—Å—ë –æ–∫**, –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ `russian.g2p` –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤—ã–¥–∞—ë—Ç –¢–û–õ–¨–ö–û —Ñ–æ–Ω–µ–º—ã –∏–∑ `_russian_phonemes` (–∏ –∑–Ω–∞–∫–∏ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–∂–µ –µ—Å—Ç—å –≤ `symbols`).

---

## 2. –ü–æ—á–µ–º—É —Ç–µ–∫—É—â–∏–π `cleaner.py` –Ω–µ –≤–∑–ª–µ—Ç–∏—Ç

–°–º–æ—Ç—Ä–∏, —á—Ç–æ —É —Ç–µ–±—è –≤–Ω—É—Ç—Ä–∏: 

### 2.1. –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ1: `clean_text` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 5 –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤

–í –∫–æ–Ω—Ü–µ —Ñ—É–Ω–∫—Ü–∏–∏:

```python
phones_return = []
for ph in phones:
    if ph not in symbols:
        phones_return.append("UNK")
        print(f"ERROR: {ph} not in symbols")
        raise Exception(f"symbol {ph} not found")
    else:
        phones_return.append(ph)
# phones = ["UNK" if ph not in symbols else ph for ph in phones]
return phones_return, words, word2ph, norm_text, string_mask
```

–ê:

* –¥–ª—è **–∫–∏—Ç–∞–π—Å–∫–æ–≥–æ/–∫–∞–Ω—Ç–æ–Ω—Å–∫–æ–≥–æ** —Ç—ã –∑–∞–¥–∞—ë—à—å —Ç–æ–ª—å–∫–æ `phones, word2ph`, –Ω–æ **–Ω–µ –∑–∞–¥–∞—ë—à—å `words` –∏ `string_mask`** ‚Äî –ø—Ä–∏ `language == "zh"` –∏–ª–∏ `"yue"` –±—É–¥–µ—Ç `NameError: name 'words' is not defined`.
* –¥–ª—è **–∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ** –≤–æ–æ–±—â–µ –Ω–µ—Ç `words` –∏ `string_mask`.

–¢–æ –µ—Å—Ç—å —Å–µ–π—á–∞—Å `clean_text` —É–ø–∞–¥—ë—Ç –¥–ª—è –ª—é–±–æ–≥–æ —è–∑—ã–∫–∞, –∫—Ä–æ–º–µ `ru`, –∞ –∏ –¥–ª—è `ru` –≤—Å—ë –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–≤–æ–π `russian.g2p`.

–ü–ª—é—Å: –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫—É—Å–∫–æ–≤ GPT-SoVITS –æ–∂–∏–¥–∞—é—Ç –æ—Ç `clean_text` **2 –∑–Ω–∞—á–µ–Ω–∏—è (phones, word2ph)**, –∞ –Ω–µ 5. –¢—ã –∏–∑–º–µ–Ω–∏–ª –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –∏ —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –Ω–∞—á–Ω—ë—Ç –ª–æ–º–∞—Ç—å—Å—è.

---

### 2.2. –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ2: –≤–µ—Ç–∫–∞ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ –∑–∞–≤—è–∑–∞–Ω–∞ –Ω–∞ —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç `g2p`

–°–µ–π—á–∞—Å:

```python
else:
    # RUSSIAN
    phones, words, word2ph, string_mask = language_module.g2p(norm_text)
    ...
```

–≠—Ç–æ –≤–µ—Ä–Ω–æ **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–≤–æ–π `russian.g2p` –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 4 –∑–Ω–∞—á–µ–Ω–∏—è** (–∫–∞–∫ –≤ —á—É–∂–æ–º –ø—Ä–æ–µ–∫—Ç–µ). –ï—Å–ª–∏ —Ç—ã —É–∂–µ –ø–µ—Ä–µ–ø–∏—Å–∞–ª —Å–≤–æ–π `russian.g2p` ¬´–ø–æ –æ–±—Ä–∞–∑—Ü—É `english.py`¬ª –∏ –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ `List[str]`, —Ç–æ —ç—Ç–∞ –≤–µ—Ç–∫–∞ –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å.

---

### 2.3. –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ3: `text_to_sequence` —Å–ª–æ–º–∞–Ω

–°–µ–π—á–∞—Å:

```python
def text_to_sequence(text, language, version=None):
    version = os.environ.get("version", version)
    if version is None:
        version = "v2"
    phones = clean_text(text)
    return cleaned_text_to_sequence(phones, version)
```

–û—à–∏–±–∫–∏:

1. –í—ã–∑–æ–≤ `clean_text(text)` **–±–µ–∑ `language`** ‚Äî Python –∫–∏–Ω–µ—Ç `TypeError: clean_text() missing 1 required positional argument: 'language'`.
2. `clean_text` —É —Ç–µ–±—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π, –∞ —Ç—ã –ø–µ—Ä–µ–¥–∞—ë—à—å –∏—Ö –≤—Å–µ –∫–∞–∫ `phones` –≤ `cleaned_text_to_sequence` ‚Äî —Ç–æ–∂–µ –Ω–µ —Ç–æ.

---

## 3. –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –≤—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ

–î–∞–ª—å—à–µ –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, **–∫–∞–∫–æ–π —Å–µ–π—á–∞—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É —Ç–≤–æ–µ–≥–æ `russian.g2p`**.

### –í–∞—Ä–∏–∞–Ω—Ç A. –¢—ã –ø–µ—Ä–µ–ø–∏—Å–∞–ª `russian.g2p` ¬´–∫–∞–∫ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π¬ª (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–ø–∏—Å–æ–∫ —Ñ–æ–Ω–µ–º)

–ï—Å–ª–∏ —Ç—ã —É–∂–µ —Å–¥–µ–ª–∞–ª –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

```python
def g2p(text: str) -> list[str]:
    # ... —Ñ–æ–Ω–µ–º–∏–∑–∞—Ü–∏—è ...
    return phones  # –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ —Ñ–æ–Ω–µ–º
```

–¢–û–ì–î–ê `cleaner.py` –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–º –∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –¥–ª—è –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤:

```python
from text import cleaned_text_to_sequence
import os

from text import symbols as symbols_v1
from text import symbols2 as symbols_v2

special = [
    ("Ôø•", "zh", "SP2"),
    ("^", "zh", "SP3"),
]


def clean_text(text, language, version=None):
    if version is None:
        version = os.environ.get("version", "v2")

    if version == "v1":
        symbols = symbols_v1.symbols
        language_module_map = {"zh": "chinese", "ja": "japanese", "en": "english"}
    else:
        symbols = symbols_v2.symbols
        language_module_map = {
            "zh": "chinese2",
            "ja": "japanese",
            "en": "english",
            "ko": "korean",
            "yue": "cantonese",
            "ru": "russian",
        }

    # –µ—Å–ª–∏ —è–∑—ã–∫ –Ω–µ –∑–Ω–∞–µ–º ‚Äî –≥–ª—É—à–∏–º
    if language not in language_module_map:
        language = "en"
        text = " "

    # —Å–ø–µ—Ü-—Å–∏–º–≤–æ–ª—ã —Ç–∏–ø–∞ Ôø• –∏ —Ç.–ø. (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å)
    for special_s, special_l, target_symbol in special:
        if special_s in text and language == special_l:
            return clean_special(text, language, special_s, target_symbol, version)

    language_module = __import__(
        "text." + language_module_map[language],
        fromlist=[language_module_map[language]],
    )

    if hasattr(language_module, "text_normalize"):
        norm_text = language_module.text_normalize(text)
    else:
        norm_text = text

    # –≤—Å–µ g2p (–≤ —Ç.—á. russian) –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ —Ñ–æ–Ω–µ–º
    phones = language_module.g2p(norm_text)
    word2ph = None  # –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø–æ-—Å–ª–æ–≤–Ω—É—é –∏–Ω—Ñ—É

    phones_return = []
    for ph in phones:
        if ph not in symbols:
            print(f"ERROR: {ph} not in symbols")
            phones_return.append("UNK")
        else:
            phones_return.append(ph)

    # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–æ–≤–Ω–æ —Ç–æ, —á—Ç–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∂–¥–µ—Ç
    return phones_return, word2ph, norm_text
```

–ò `text_to_sequence`:

```python
def text_to_sequence(text, language, version=None):
    if version is None:
        version = os.environ.get("version", "v2")
    phones, word2ph, norm_text = clean_text(text, language, version)
    return cleaned_text_to_sequence(phones, version)
```

–í —ç—Ç–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ **`russian.g2p` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ—Å—Ç—ã–º, –∫–∞–∫ `english.g2p`**. –¢–æ–≥–¥–∞ –≤—Å—ë –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–≤–æ–∏–º–∏ `symbols` –∏ `symbols2`.

---

### –í–∞—Ä–∏–∞–Ω—Ç B. –¢—ã –æ—Å—Ç–∞–≤–∏–ª ¬´—Ç–æ–ª—Å—Ç—ã–π¬ª `russian.g2p` (4 –∑–Ω–∞—á–µ–Ω–∏—è: phones, words, word2ph, string_mask)

–¢–æ–≥–¥–∞:

* –¥–ª—è ru –Ω—É–∂–Ω–æ –≤—ã–¥–µ—Ä–Ω—É—Ç—å –∏–∑ –Ω–µ–≥–æ —Ç–æ–ª—å–∫–æ `phones` –∏ `word2ph`, –∞ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–¥–µ-–Ω–∏–±—É–¥—å –µ—â—ë (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ);
* –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —è–∑—ã–∫–æ–≤ ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–∂–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç.

–ü—Ä–∏–º–µ—Ä:

```python
def clean_text(text, language, version=None):
    if version is None:
        version = os.environ.get("version", "v2")

    if version == "v1":
        symbols = symbols_v1.symbols
        language_module_map = {"zh": "chinese", "ja": "japanese", "en": "english"}
    else:
        symbols = symbols_v2.symbols
        language_module_map = {
            "zh": "chinese2",
            "ja": "japanese",
            "en": "english",
            "ko": "korean",
            "yue": "cantonese",
            "ru": "russian",
        }

    if language not in language_module_map:
        language = "en"
        text = " "

    language_module = __import__(
        "text." + language_module_map[language],
        fromlist=[language_module_map[language]],
    )

    if hasattr(language_module, "text_normalize"):
        norm_text = language_module.text_normalize(text)
    else:
        norm_text = text

    if language in ("zh", "yue"):
        phones, word2ph = language_module.g2p(norm_text)
    elif language == "en":
        phones = language_module.g2p(norm_text)
        if len(phones) < 4:
            phones = [","] + phones
        word2ph = None
    elif language == "ru":
        phones, words, word2ph, string_mask = language_module.g2p(norm_text)
        # –µ—Å–ª–∏ string_mask/words –≥–¥–µ-—Ç–æ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è ‚Äî –ø—Ä–∏–¥—ë—Ç—Å—è –∏—Ö –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
    else:
        phones = language_module.g2p(norm_text)
        word2ph = None

    phones_return = []
    for ph in phones:
        if ph not in symbols:
            print(f"ERROR: {ph} not in symbols")
            phones_return.append("UNK")
        else:
            phones_return.append(ph)

    return phones_return, word2ph, norm_text
```

–ò —Å–Ω–æ–≤–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π `text_to_sequence`, –∫–∞–∫ –≤—ã—à–µ.

---

## 4. –û—Ç–≤–µ—Ç –Ω–∞ —Ç–≤–æ–π –≤–æ–ø—Ä–æ—Å ¬´–±—É–¥–µ—Ç –ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å¬ª

* **`symbols.py` –∏ `symbols2.py` ‚Äî –¥–∞, –æ–Ω–∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä—É—Å—Å–∫–∏–º —Ñ–æ–Ω–µ–º–∞–º.**
* **`cleaner.py` –≤ —Ç–µ–∫—É—â–µ–º –≤–∏–¥–µ ‚Äî –Ω–µ—Ç**, –æ–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å:

  * `clean_text` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–π –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ;
  * `text_to_sequence` –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç `language` –∏ –Ω–µ–≤–µ—Ä–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç `clean_text`.

–ß—Ç–æ–±—ã –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ, –Ω—É–∂–Ω–æ:

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `russian.g2p` (—Å–ø–∏—Å–æ–∫ —Ñ–æ–Ω–µ–º –∏–ª–∏ 4 –∑–Ω–∞—á–µ–Ω–∏—è).
2. –ü–æ–¥ —ç—Ç–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å `clean_text` —Ç–∞–∫, —á—Ç–æ–±—ã:

   * –æ–Ω **–Ω–µ –ª–æ–º–∞–ª —Ñ–æ—Ä–º–∞—Ç** –¥–ª—è –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–æ–≤;
   * –≤–æ–∑–≤—Ä–∞—â–∞–ª –ø–æ–Ω—è—Ç–Ω—ã–π –∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–æ—Ä—Ç–µ–∂ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `phones, word2ph, norm_text`);
   * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –¥–∞–ª—å—à–µ –ø—Ä—è–º–æ –ø–æ–¥ —Ç–≤–æ–π —Ç–µ–∫—É—â–∏–π `russian.py` (–∫–∞–∫ –æ–Ω –µ—Å—Ç—å) –Ω–∞–ø–∏—Å–∞—Ç—å –≥–æ—Ç–æ–≤—É—é –≤–µ—Ä—Å–∏—é `cleaner.py`, —á—Ç–æ–±—ã —Ç—ã –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏–ª —Ñ–∞–π–ª.
