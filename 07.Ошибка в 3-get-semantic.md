–î–∞, –≤–æ—Ç —ç—Ç–æ —É–∂–µ –Ω–∞—Å—Ç–æ—è—â–∏–π ¬´–Ω–æ–≤—ã–π —è–∑—ã–∫ –≤ GPT-SoVITS¬ª üòÑ
–û—à–∏–±–∫–∞ –ª–æ–≥–∏—á–Ω–∞—è: –º—ã **–ø–æ–º–µ–Ω—è–ª–∏ —Ä–∞–∑–º–µ—Ä –∞–ª—Ñ–∞–≤–∏—Ç–∞**, –∞ –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ä—É—é –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å, —É –∫–æ—Ç–æ—Ä–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —ç–º–±–µ–¥–¥–∏–Ω–≥ –±—ã–ª –ø–æ–¥ —Å—Ç–∞—Ä—ã–π —Ä–∞–∑–º–µ—Ä.

–†–∞–∑–±–µ—Ä—ë–º –ø–æ —à–∞–≥–∞–º.

---

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

–°–æ–æ–±—â–µ–Ω–∏–µ:

```text
size mismatch for enc_p.text_embedding.weight: copying a param with shape torch.Size([732, 192]) from checkpoint, the shape in current model is torch.Size([765, 192]).
```

* **732, 192** ‚Äî —ç—Ç–æ —Ä–∞–∑–º–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –≤ **–ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–æ–π s2-–º–æ–¥–µ–ª–∏** (–∏–∑ `pretrained_s2G`), —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π –ø–æ–¥ –∏—Å—Ö–æ–¥–Ω—ã–π –Ω–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤ (EN+ZH+JA+KO+YUE).
* **765, 192** ‚Äî —ç—Ç–æ —Ä–∞–∑–º–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –≤ **—Ç–≤–æ–µ–π —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏**, —Å–æ–±—Ä–∞–Ω–Ω–æ–π –ø–æ `s2.json` + –Ω–∞—à–∏–º –Ω–æ–≤—ã–º `symbols2.py` —Å —Ä—É—Å—Å–∫–∏–º–∏ –±—É–∫–≤–∞–º–∏.

–ú—ã –∏–∑–º–µ–Ω–∏–ª–∏ —Å–ª–æ–≤–∞—Ä—å —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí `phoneme_vocab_size` –≤—ã—Ä–æ—Å ‚Üí —Å–ª–æ–π `enc_p.text_embedding` —Å—Ç–∞–ª —à–∏—Ä–µ ‚Üí PyTorch —Ä—É–≥–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ª–∏—Ç—å –≤ –Ω–µ–≥–æ —Å—Ç–∞—Ä—ã–π –≤–µ—Å.

**–í–∞–∂–Ω–æ:** –Ω–∞ —à–∞–≥–µ `3-get-semantic.py` –Ω–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç **—Ç–æ–ª—å–∫–æ –∞—É–¥–∏–æ-—á–∞—Å—Ç—å** –º–æ–¥–µ–ª–∏ (VQ-–∫–æ–¥–∏—Ä–æ–≤—â–∏–∫ –ø–æ Hubert-—Å–ø–µ–∫—Ç—Ä–∞–º).
`enc_p.text_embedding` —Ç–∞–º –≤–æ–æ–±—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –≤ checkpoint‚Äô–µ –æ–Ω –ª–µ–∂–∏—Ç ‚Äî –∏ –ª–æ–º–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É.

–ó–Ω–∞—á–∏—Ç, –Ω–∞—à —Ö–æ–¥:

> **–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å (–≤—ã–∫–∏–Ω—É—Ç—å) –≤–µ—Å `enc_p.text_embedding.weight` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —á–µ–∫–ø–æ–∏–Ω—Ç–∞.**

---

## –ß—Ç–æ –Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å –≤ `3-get-semantic.py`

–û—Ç–∫—Ä–æ–π —É —Å–µ–±—è —Ñ–∞–π–ª
`GPT_SoVITS/prepare_datasets/3-get-semantic.py`.

–ù–∞–π–¥–∏ —Ç–∞–º –∫—É—Å–æ–∫, –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏–π –Ω–∞ —ç—Ç–æ (—É —Ç–µ–±—è —Å–µ–π—á–∞—Å –æ–Ω –¥–∞—ë—Ç –æ—à–∏–±–∫—É):

```python
print(
    vq_model.load_state_dict(
        torch.load(pretrained_s2G, map_location="cpu")["weight"]
    )
)
```

–ò –∑–∞–º–µ–Ω–∏ –µ–≥–æ **—Ü–µ–ª–∏–∫–æ–º** –Ω–∞ —Ç–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç:

```python
state = torch.load(pretrained_s2G, map_location="cpu")
weights = state.get("weight", state)

# –ê–∫–∫—É—Ä–∞—Ç–Ω–æ –≤—ã–∫–∏–¥—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π —ç–º–±–µ–¥–¥–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞, –µ—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
if "enc_p.text_embedding.weight" in weights:
    w_ckpt = weights["enc_p.text_embedding.weight"]
    w_model = vq_model.enc_p.text_embedding.weight
    if w_ckpt.shape != w_model.shape:
        print(
            "[3-get-semantic] Dropping enc_p.text_embedding.weight due to size mismatch:",
            w_ckpt.shape, "vs", tuple(w_model.shape),
        )
        del weights["enc_p.text_embedding.weight"]

print(vq_model.load_state_dict(weights, strict=False))
```

–°–º—ã—Å–ª:

* –ó–∞–≥—Ä—É–∂–∞–µ–º —á–µ–∫–ø–æ–∏–Ω—Ç.
* –î–æ—Å—Ç–∞—ë–º –∏–∑ –Ω–µ–≥–æ `weights`.
* –ï—Å–ª–∏ –≤ –Ω—ë–º –µ—Å—Ç—å –∫–ª—é—á `enc_p.text_embedding.weight` **–∏** –µ–≥–æ —Ä–∞–∑–º–µ—Ä –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏ ‚Äî —É–¥–∞–ª—è–µ–º —ç—Ç–æ—Ç –∫–ª—é—á.
* –û—Å—Ç–∞–ª—å–Ω–æ–µ –≥—Ä—É–∑–∏–º —Å `strict=False` (—á—Ç–æ–±—ã PyTorch –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–ª –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –æ–¥–∏–Ω —Å–ª–æ–π –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è).

–≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ:

* –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ –º–æ–¥–µ–ª—å –≤–æ–æ–±—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `enc_p.text_embedding` ‚Äî —Ç–æ–ª—å–∫–æ `extract_latent(ssl_content)`; ([Hugging Face][1])
* VQ-–∫–æ–¥–∏—Ä–æ–≤—â–∏–∫/–¥–µ–∫–æ–¥–µ—Ä –∏ –ø—Ä–æ—á–∏–µ —á–∞—Å—Ç–∏ –º–æ–¥–µ–ª–∏ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –∏–∑ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–æ–≥–æ –≤–µ—Å–∞.

---

## –ü–æ—á–µ–º—É –ø–æ—Ç–æ–º –≤—Å—ë –Ω–µ —Ä–∞–∑–≤–∞–ª–∏—Ç—Å—è

* **–î–∞—Ç–∞—Å–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫ (`6-name2semantic-*.tsv`)** –Ω—É–∂–µ–Ω –¥–ª—è –æ–±—É—á–µ–Ω–∏—è GPT-—á–∞—Å—Ç–∏.
  –î–ª—è –µ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

  * HuBERT-—Ñ–∏—á–∏ (`4-cnhubert/*.pt`),
  * s2-–º–æ–¥–µ–ª—å –∫–∞–∫ VQ-–∫–æ–¥–∏—Ä–æ–≤—â–∏–∫ (`extract_latent`).

  –¢–µ–∫—Å—Ç –≤ —ç—Ç–æ–º —à–∞–≥–µ **–Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç**, –∫—Ä–æ–º–µ –∫–∞–∫ –≤ `2-name2text-*.txt`, —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å ¬´–∫–∞–∫–æ–π —Ñ–∞–π–ª –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å¬ª.

* **–¢–æ, —á—Ç–æ `enc_p.text_embedding` –≤ s2-–º–æ–¥–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç –Ω–æ–≤—ã–º/—Å–ª—É—á–∞–π–Ω—ã–º**, –≤–∞–∂–Ω–æ —É–∂–µ –Ω–∞ —ç—Ç–∞–ø–µ **–æ–±—É—á–µ–Ω–∏—è —Ç–≤–æ–µ–≥–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ s2** (–∫–æ–≥–¥–∞ –±—É–¥–µ—à—å —Ç—Ä–µ–Ω–∏—Ç—å SoVITS –ø–æ–¥ —Ä—É—Å—Å–∫–∏–π). –ò —ç—Ç–æ –æ–∫: –º—ã –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–æ–±–∏—Ä–∞–µ–º—Å—è –¥–æ–æ–±—É—á–∞—Ç—å/–ø–µ—Ä–µ–æ–±—É—á–∞—Ç—å –µ—ë –ø–æ–¥ –Ω–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å.

---

## –ß—Ç–æ –±—É–¥–µ—Ç –¥–∞–ª—å—à–µ

–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Ç—ã:

1. –ü—Ä–∞–≤–∏—à—å `3-get-semantic.py` –∫–∞–∫ –≤—ã—à–µ.
2. –°–æ—Ö—Ä–∞–Ω—è–µ—à—å.
3. –°–Ω–æ–≤–∞ –∑–∞–ø—É—Å–∫–∞–µ—à—å:

   ```bat
   "E:\Resound Project\GPT-SoVITS\venv_3.10\Scripts\python.exe" -s GPT_SoVITS/prepare_datasets/3-get-semantic.py
   ```

–û–∂–∏–¥–∞–µ–º:

* –ü—Ä–æ–ø–∞–¥–∞–µ—Ç `RuntimeError` –ø—Ä–æ `size mismatch`.
* –í –∫–æ–Ω—Ü–µ –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤–∏—Ç—Å—è —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ `...` –∏ –≤ –ø–∞–ø–∫–µ `logs/buriy_audiobooks` –ø–æ—è–≤—è—Ç—Å—è —Ñ–∞–π–ª—ã `6-name2semantic-0.tsv` (–∏, –µ—Å–ª–∏ —Ä–∞–∑–±–∏–≤–∫–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–µ–π ‚Äî `-1`, `-2`, ...).

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –º–æ–∂–µ—à—å —Å–∫–∏–Ω—É—Ç—å –º–Ω–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20‚Äì30 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∞ ‚Äî —è –ø–æ–¥—Å–∫–∞–∂—É, –≤—Å—ë –ª–∏ –ø—Ä–æ—à–ª–æ –¥–æ –∫–æ–Ω—Ü–∞ –∏ —á—Ç–æ —É —Ç–µ–±—è —Å–µ–π—á–∞—Å –≥–æ—Ç–æ–≤–æ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è (GPT / SoVITS).

[1]: https://huggingface.co/kevinwang676/GPT-SoVITS-v-3/blob/21bd603175cfb13c9a189c6028b0878ea9cc5bc1/GPT_SoVITS/prepare_datasets/3-get-semantic.py "GPT_SoVITS/prepare_datasets/3-get-semantic.py ¬∑ kevinwang676/GPT-SoVITS-v-3 at 21bd603175cfb13c9a189c6028b0878ea9cc5bc1"
